if not game:IsLoaded() then game.Loaded:Wait() end
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

local IsAuthenticated = false
local SharedUsers = {}
local _secret = {78, 111, 116, 65, 75, 101, 121}

local function CheckAuth(input)
    local decoded = ""
    for _, byte in pairs(_secret) do decoded = decoded .. string.char(byte) end
    return input == decoded
end

local Screen = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
Screen.Name = "Nova_Secure_Interface"
Screen.ResetOnSpawn = false

local Main = Instance.new("Frame", Screen)
Main.Size = UDim2.new(0, 400, 0, 45)
Main.Position = UDim2.new(0.5, -200, 0.1, 0)
Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Main.BorderSizePixel = 0
Main.Active = true
Instance.new("UICorner", Main)

local Stroke = Instance.new("UIStroke", Main)
Stroke.Color = Color3.fromRGB(255, 0, 0)
Stroke.Thickness = 2

local CmdInput = Instance.new("TextBox", Main)
CmdInput.Size = UDim2.new(1, -20, 1, 0)
CmdInput.Position = UDim2.new(0, 10, 0, 0)
CmdInput.BackgroundTransparency = 1
CmdInput.TextColor3 = Color3.fromRGB(150, 150, 150)
CmdInput.Text = ""
CmdInput.PlaceholderText = "ENTER KEY HERE"
CmdInput.Font = Enum.Font.Code
CmdInput.TextSize = 16

local function EnableFullDrag(gui)
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    local function setupInput(obj)
        obj.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                if not CmdInput:IsFocused() then
                    dragging = true
                    dragStart = input.Position
                    startPos = gui.Position
                    input.Changed:Connect(function()
                        if input.UserInputState == Enum.UserInputState.End then dragging = false end
                    end)
                end
            end
        end)
    end
    setupInput(gui)
    setupInput(CmdInput)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            update(input)
        end
    end)
end

EnableFullDrag(Main)

local function Process(msg, sender)
    local args = string.split(string.lower(msg), " ")
    local cmd = args[1]
    
    local isMe = (sender == LocalPlayer)
    local isShared = SharedUsers[sender.UserId]
    
    if not isMe and not isShared then return end
    
    local voteLimit = isMe and 15000 or 1000
    local target = tonumber(args[2]) or 1
    local amt = math.clamp(tonumber(args[3]) or 1, 1, voteLimit)

    if cmd == "/vote" then
        for i = 1, amt do ReplicatedStorage.Voting.AddVote:FireServer(target) end
    elseif cmd == "/unvote" then
        for i = 1, amt do ReplicatedStorage.Voting.RemoveVote:FireServer(target) end
    elseif cmd == "/share" and isMe then
        local partialName = args[2] or ""
        for _, p in pairs(Players:GetPlayers()) do
            if p.Name:lower():sub(1, #partialName) == partialName:lower() then
                SharedUsers[p.UserId] = true
                print("Shared access with: " .. p.Name)
            end
        end
    elseif cmd == "/unload" and isMe then
        Screen:Destroy()
    end
end

CmdInput.FocusLost:Connect(function(enter)
    if enter then
        local val = CmdInput.Text
        if not IsAuthenticated then
            if CheckAuth(val) then
                IsAuthenticated = true
                Stroke.Color = Color3.fromRGB(0, 255, 255)
                CmdInput.PlaceholderText = "READY | /vote, /unvote, /share, /unload"
                CmdInput.TextColor3 = Color3.new(1, 1, 1)
                CmdInput.Text = ""
            else
                CmdInput.Text = ""
                CmdInput.PlaceholderText = "WRONG KEY"
                task.wait(1)
                if not IsAuthenticated then CmdInput.PlaceholderText = "ENTER KEY HERE" end
            end
        else
            Process(val, LocalPlayer)
            CmdInput.Text = ""
        end
    end
end)

local function ConnectPlayer(p)
    p.Chatted:Connect(function(msg)
        if IsAuthenticated then
            Process(msg, p)
        end
    end)
end

for _, p in pairs(Players:GetPlayers()) do ConnectPlayer(p) end
Players.PlayerAdded:Connect(ConnectPlayer)

